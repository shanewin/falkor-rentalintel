{% extends "base.html" %}
{% load static %}

{% block title %}Set New Password - Doorway{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/doorway-forms.css' %}">
<style>
    .auth-card {
        max-width: 500px;
        margin: 70px auto;
        padding: 30px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    .auth-header {
        text-align: center;
        margin-bottom: 20px;
    }
    .auth-header h2 {
        color: #333;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="auth-card">
    {% if validlink %}
        <div class="auth-header">
            <h2>Create a new password</h2>
            <p class="text-muted mb-0">Choose a strong password to keep your account secure.</p>
        </div>

        <form method="post" class="doorway-form">
            {% csrf_token %}

            {% if form.non_field_errors %}
                <div class="alert alert-danger">
                    {{ form.non_field_errors.0 }}
                </div>
            {% endif %}

            <div class="form-group mb-3">
                <label for="{{ form.new_password1.id_for_label }}" class="form-label">New password</label>
                <input
                    type="password"
                    name="{{ form.new_password1.name }}"
                    id="{{ form.new_password1.id_for_label }}"
                    class="form-control"
                    placeholder="New password"
                    autocomplete="new-password"
                    required
                >
                {% if form.new_password1.errors %}
                    <div class="text-danger small mt-1">{{ form.new_password1.errors.0 }}</div>
                {% endif %}
            </div>

            <div class="form-group mb-3">
                <label for="{{ form.new_password2.id_for_label }}" class="form-label">Confirm new password</label>
                <input
                    type="password"
                    name="{{ form.new_password2.name }}"
                    id="{{ form.new_password2.id_for_label }}"
                    class="form-control"
                    placeholder="Confirm password"
                    autocomplete="new-password"
                    required
                >
                {% if form.new_password2.errors %}
                    <div class="text-danger small mt-1">{{ form.new_password2.errors.0 }}</div>
                {% endif %}
            </div>

            <button type="submit" class="btn btn-doorway-primary w-100">
                <i class="fas fa-key"></i> Save new password
            </button>
        </form>
    {% else %}
        <div class="auth-header">
            <h2>Link not valid</h2>
            <p class="text-muted">This password reset link is invalid or has already been used.</p>
        </div>
        <div class="text-center">
            <a href="{% url 'password_reset' %}" class="btn btn-doorway-primary">Request a new link</a>
        </div>
    {% endif %}

    <div class="text-center mt-3">
        <a href="{% url 'login' %}">Back to login</a>
    </div>
</div>
{% endblock %}
