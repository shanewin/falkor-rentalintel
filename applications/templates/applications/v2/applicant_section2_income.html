{% extends 'applications/applicant_base.html' %}
{% load static %}

{% block title %}Section 2: Income & Employment{% endblock %}

{% block header_title %}Income & Employment{% endblock %}
{% block header_subtitle %}Section 2 of 5 â€¢ Financial Qualification{% endblock %}

{% block content %}
<div class="row">
    <!-- Main Content -->
    <div class="col-lg-8">
        <div class="form-card shadow-sm mb-4">
            <div class="form-card-header">
                <h5 class="mb-0"><i class="bi bi-briefcase me-2 text-warning"></i>Employment Information</h5>
            </div>
            
            <p class="text-muted small mb-4">Please provide your employment details and annual income. This information is confidential and used only for qualification purposes.</p>

            <form method="post" enctype="multipart/form-data" class="doorway-form">
                {% csrf_token %}

                <!-- Basic Employment -->
                <div class="mb-4">
                    <div class="mb-3">
                        <label for="{{ form.employer.id_for_label }}" class="form-label">Current Employer</label>
                        {{ form.employer }}
                        {% if form.employer.errors %}
                            <div class="text-danger small">{{ form.employer.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.job_title.id_for_label }}" class="form-label">Job Title</label>
                        {{ form.job_title }}
                        {% if form.job_title.errors %}
                            <div class="text-danger small">{{ form.job_title.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="{{ form.annual_income.id_for_label }}" class="form-label">Annual Income</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            {{ form.annual_income }}
                        </div>
                        <div class="form-text small">Gross annual income before taxes.</div>
                        {% if form.annual_income.errors %}
                            <div class="text-danger small">{{ form.annual_income.errors }}</div>
                        {% endif %}
                    </div>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="{{ form.employment_length.id_for_label }}" class="form-label">Length of Employment</label>
                            {{ form.employment_length }}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label d-block">Currently Employed Here?</label>
                            {% for radio in form.currently_employed %}
                            <div class="form-check form-check-inline">
                                {{ radio.tag }}
                                <label class="form-check-label" for="{{ radio.id_for_label }}">
                                    {{ radio.choice_label }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Supervisor Info -->
                <h6 class="fw-bold mb-3 border-bottom pb-2 mt-4">Supervisor Information</h6>
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <label for="{{ form.supervisor_name.id_for_label }}" class="form-label">Name</label>
                        {{ form.supervisor_name }}
                    </div>
                    <div class="col-md-4">
                        <label for="{{ form.supervisor_phone.id_for_label }}" class="form-label">Phone</label>
                        {{ form.supervisor_phone }}
                    </div>
                    <div class="col-md-4">
                        <label for="{{ form.supervisor_email.id_for_label }}" class="form-label">Email</label>
                        {{ form.supervisor_email }}
                    </div>
                </div>

                <!-- Additional Income -->
                <h6 class="fw-bold mb-3 border-bottom pb-2 mt-4">Additional Income & Assets</h6>
                
                <div class="mb-4">
                    <label class="form-label fw-bold d-block">I have additional sources of income</label>
                    <p class="text-muted small mb-2">(e.g., bonuses, investments, freelance)</p>
                    {% for radio in form.has_additional_income %}
                    <div class="form-check form-check-inline">
                        {{ radio.tag }}
                        <label class="form-check-label" for="{{ radio.id_for_label }}">
                            {{ radio.choice_label }}
                        </label>
                    </div>
                    {% endfor %}

                    <div id="additional-income-section" class="mt-3 {% if not form.has_additional_income.value == True %}d-none{% endif %} bg-light p-3 rounded">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="{{ form.additional_income_source.id_for_label }}" class="form-label">Source</label>
                                {{ form.additional_income_source }}
                            </div>
                            <div class="col-md-6">
                                <label for="{{ form.additional_income_amount.id_for_label }}" class="form-label">Annual Amount</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    {{ form.additional_income_amount }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <label class="form-label fw-bold d-block">I have multiple jobs</label>
                        {% for radio in form.has_multiple_jobs %}
                        <div class="form-check form-check-inline">
                            {{ radio.tag }}
                            <label class="form-check-label" for="{{ radio.id_for_label }}">
                                {{ radio.choice_label }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold d-block">I have significant assets</label>
                        {% for radio in form.has_assets %}
                        <div class="form-check form-check-inline">
                            {{ radio.tag }}
                            <label class="form-check-label" for="{{ radio.id_for_label }}">
                                {{ radio.choice_label }}
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Proof of Income -->
                <h6 class="fw-bold mb-3 border-bottom pb-2 mt-4">Proof of Income</h6>
                <div class="mb-4">
                    <label for="{{ form.proof_of_income.id_for_label }}" class="form-label">Upload Pay Stubs or Offer Letter</label>
                    {{ form.proof_of_income }}
                    <div class="form-text small">Accepted formats: PDF, JPG, PNG. Max size: 5MB.</div>
                    {% if form.proof_of_income.errors %}
                        <div class="text-danger small">{{ form.proof_of_income.errors }}</div>
                    {% endif %}
                </div>

                <!-- Form Actions -->
                <div class="d-flex justify-content-between mt-5 pt-3 border-top">
                    <a href="{% url 'section1_personal_info' application.id %}{% if token %}?token={{ token }}{% endif %}" class="btn btn-outline-dark">
                        <i class="bi bi-arrow-left me-2"></i> Back
                    </a>
                    <button type="submit" class="btn btn-warning px-5 fw-bold shadow-sm">
                        Save and Continue <i class="bi bi-arrow-right ms-2"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        {% include 'applications/v2/_application_sidebar.html' with current_step=2 hide_sidebar_image=True hide_property_details=True show_detailed_info=True %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const additionalIncomeRadios = document.querySelectorAll('input[name="has_additional_income"]');
        const additionalIncomeSection = document.getElementById('additional-income-section');

        additionalIncomeRadios.forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'True') {
                    additionalIncomeSection.classList.remove('d-none');
                } else {
                    additionalIncomeSection.classList.add('d-none');
                }
            });
        });
    });
</script>
{% endblock %}